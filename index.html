<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>远光84民间论坛</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Montserrat:wght@500;600;700;800&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#10B981',
                        accent: '#F59E0B',
                        dark: '#111827',
                        light: '#F9FAFB',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        display: ['Montserrat', 'sans-serif'],
                    },
                    animation: {
                        'float': 'float 3s ease-in-out infinite',
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        }
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .text-shadow {
                text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            .text-gradient {
                background-clip: text;
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
            }
            .card-hover {
                transition: all 0.3s ease;
            }
            .card-hover:hover {
                transform: translateY(-8px);
            }
            .probability-bar {
                height: 8px;
                border-radius: 4px;
                transition: width 0.5s ease;
            }
            .glass-effect {
                background: rgba(255, 255, 255, 0.05);
                backdrop-filter: blur(10px);
                -webkit-backdrop-filter: blur(10px);
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-900 to-gray-800 text-light min-h-screen font-sans">
    <!-- 背景装饰 -->
    <div class="fixed inset-0 overflow-hidden pointer-events-none z-0">
        <div class="absolute -top-40 -right-40 w-96 h-96 bg-primary/20 rounded-full blur-3xl"></div>
        <div class="absolute top-1/3 -left-20 w-72 h-72 bg-accent/10 rounded-full blur-3xl"></div>
        <div class="absolute bottom-0 right-1/4 w-80 h-80 bg-secondary/10 rounded-full blur-3xl"></div>
    </div>

    <!-- 顶部导航 -->
    <header class="relative bg-gray-900/80 backdrop-blur-md shadow-lg sticky top-0 z-30 border-b border-gray-800">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <div class="w-10 h-10 rounded-full bg-gradient-to-r from-primary to-secondary flex items-center justify-center animate-pulse-slow">
                    <i class="fa fa-comments text-white text-xl"></i>
                </div>
                <h1 class="text-xl sm:text-2xl font-display font-bold bg-gradient-to-r from-primary to-secondary text-gradient">
                    远光84民间论坛
                </h1>
            </div>
            <div class="text-sm text-gray-400 hidden sm:block">
                <span id="currentDate"></span>
            </div>
        </div>
    </header>

    <!-- 管理员登录入口（角落） -->
    <button id="adminLoginBtn" class="fixed top-4 right-4 z-40 glass-effect hover:bg-gray-800/60 text-gray-300 hover:text-white px-3 py-2 rounded-lg text-sm transition-all duration-300 flex items-center opacity-70 hover:opacity-100 border border-gray-700/50">
        <i class="fa fa-cog mr-2"></i> 管理
    </button>

    <!-- 主内容区 -->
    <main class="relative container mx-auto px-4 sm:px-6 lg:px-8 py-10 lg:py-16 max-w-6xl z-10">
        <!-- 欢迎信息 -->
        <div class="text-center mb-12 lg:mb-16">
            <h2 class="text-[clamp(1.8rem,5vw,3rem)] font-display font-bold text-white mb-4 text-shadow">
                论坛奖励兑换中心
            </h2>
            <p class="text-gray-400 max-w-2xl mx-auto text-lg">
                选择盲盒等级，输入兑换码即可获取论坛专属奖励
            </p>
        </div>

        <!-- 盲盒等级选择区 -->
        <div class="bg-gray-800/60 backdrop-blur-md rounded-2xl p-6 lg:p-8 mb-12 border border-gray-700/50 shadow-xl">
            <h3 class="text-xl font-display font-semibold text-white mb-6 text-center">选择盲盒等级</h3>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6" id="boxSelectionContainer">
                <!-- 盲盒等级选择将通过JS动态生成 -->
            </div>
        </div>

        <!-- 兑换码输入区 -->
        <div class="bg-gray-800/60 backdrop-blur-md rounded-2xl p-6 lg:p-8 mb-16 border border-gray-700/50 shadow-xl hidden" id="redeemCodeContainer">
            <h3 class="text-xl font-display font-semibold text-white mb-6 text-center">
                兑换 <span id="selectedBoxName" class="text-primary">初级盲盒</span>
            </h3>
            
            <form id="redeemForm" class="max-w-md mx-auto space-y-5">
                <input type="hidden" id="selectedBoxId">
                
                <div>
                    <label for="redeemCode" class="block text-sm font-medium text-gray-300 mb-2">请输入兑换码</label>
                    <input type="text" id="redeemCode" required placeholder="例如：YG84-XXXX-XXXX" class="w-full bg-gray-700/50 border border-gray-600 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all">
                    <p class="text-xs text-gray-500 mt-1">兑换码区分大小写，请正确输入</p>
                </div>
                
                <div class="flex flex-col sm:flex-row gap-4">
                    <button type="button" id="cancelRedeemBtn" class="flex-1 py-3 rounded-lg bg-gray-700 hover:bg-gray-600 text-white font-medium transition-all">
                        取消
                    </button>
                    <button type="submit" class="flex-1 py-3 rounded-lg bg-primary hover:bg-primary/90 text-white font-medium transition-all">
                        确认兑换
                    </button>
                </div>
            </form>
            
            <div class="mt-6 text-center">
                <p id="boxLimitInfo" class="text-sm text-gray-400">
                    今日剩余: 10/10
                </p>
            </div>
        </div>

        <!-- 盲盒概率说明 -->
        <div class="bg-gray-800/60 backdrop-blur-md rounded-2xl p-6 lg:p-8 mb-16 border border-gray-700/50 shadow-xl">
            <h3 class="text-xl font-display font-semibold text-white mb-6 text-center">盲盒奖励概率说明</h3>
            
            <div class="space-y-8" id="probabilityInfoContainer">
                <!-- 概率说明将通过JS动态生成 -->
            </div>
        </div>

        <!-- 最近兑换记录 -->
        <div>
            <h3 class="text-xl font-display font-semibold text-white mb-6 flex items-center">
                <i class="fa fa-history text-primary mr-3"></i> 最近兑换记录
            </h3>
            <div class="bg-gray-800/60 backdrop-blur-md rounded-2xl shadow-xl border border-gray-700/50 overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-700">
                        <thead class="bg-gray-800/80">
                            <tr>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">盲盒等级</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">奖励</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">兑换时间</th>
                            </tr>
                        </thead>
                        <tbody id="recentRedeems" class="divide-y divide-gray-700/50">
                            <!-- 最近兑换记录将通过JS动态生成 -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <!-- 页脚 -->
    <footer class="relative bg-gray-900/80 backdrop-blur-md py-8 border-t border-gray-800 z-10">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 text-center text-gray-500 text-sm">
            <p>远光84民间论坛 © <span id="currentYear"></span></p>
            <p class="mt-2">专注于提供优质交流平台与用户福利</p>
        </div>
    </footer>

    <!-- 兑换结果模态框 -->
    <div id="resultModal" class="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center hidden opacity-0 transition-opacity duration-300">
        <div class="bg-gray-800 rounded-2xl w-full max-w-md p-6 lg:p-8 shadow-2xl transform transition-all scale-95 opacity-0" id="resultModalContent">
            <div id="successResult" class="text-center mb-6 hidden">
                <div class="w-20 h-20 bg-secondary/20 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fa fa-check text-3xl text-secondary"></i>
                </div>
                <h3 class="text-2xl font-display font-bold text-white">兑换成功！</h3>
                <p id="successMessage" class="text-gray-300 mt-3"></p>
            </div>
            <div id="errorResult" class="text-center mb-6 hidden">
                <div class="w-20 h-20 bg-red-500/20 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fa fa-times text-3xl text-red-500"></i>
                </div>
                <h3 class="text-2xl font-display font-bold text-white">兑换失败</h3>
                <p id="errorMessage" class="text-gray-300 mt-3"></p>
            </div>
            <button id="closeResultBtn" class="w-full py-3 rounded-lg bg-gray-700 hover:bg-gray-600 text-white font-medium transition-all">
                确定
            </button>
        </div>
    </div>

    <!-- 管理员登录模态框 -->
    <div id="adminLoginModal" class="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center hidden opacity-0 transition-opacity duration-300">
        <div class="bg-gray-800 rounded-2xl w-full max-w-md p-6 lg:p-8 shadow-2xl transform transition-all scale-95 opacity-0" id="adminLoginModalContent">
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fa fa-lock text-gray-300 text-2xl"></i>
                </div>
                <h3 class="text-2xl font-display font-bold text-white">管理员登录</h3>
            </div>
            <form id="adminLoginForm" class="space-y-5">
                <div>
                    <label for="adminPassword" class="block text-sm font-medium text-gray-300 mb-2">请输入管理员密码</label>
                    <input type="password" id="adminPassword" required class="w-full bg-gray-700/50 border border-gray-600 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all">
                </div>
                <button type="submit" class="w-full py-3 rounded-lg bg-gray-700 hover:bg-gray-600 text-white font-medium transition-all">
                    登录
                </button>
            </form>
        </div>
    </div>

    <!-- 管理员面板 -->
    <div id="adminPanel" class="fixed inset-0 bg-gray-800 z-50 transform translate-x-full transition-transform duration-300 ease-in-out">
        <div class="h-full flex flex-col overflow-hidden">
            <!-- 管理员面板头部 -->
            <div class="bg-gray-900 p-5 flex justify-between items-center border-b border-gray-700">
                <h2 class="text-xl font-display font-bold text-white flex items-center">
                    <i class="fa fa-cogs mr-3 text-primary"></i> 管理员面板
                </h2>
                <button id="closeAdminPanel" class="text-gray-400 hover:text-white transition-colors p-2">
                    <i class="fa fa-times text-xl"></i>
                </button>
            </div>
            
            <!-- 管理员面板内容 -->
            <div class="flex-1 overflow-y-auto p-6">
                <!-- 数据统计 -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-5 mb-8">
                    <div class="bg-gray-900/50 rounded-xl p-5 border border-gray-700/50 shadow-lg">
                        <h3 class="text-sm text-gray-400 mb-2">总兑换码数</h3>
                        <p id="totalCodes" class="text-3xl font-display font-bold text-white">0</p>
                    </div>
                    <div class="bg-gray-900/50 rounded-xl p-5 border border-gray-700/50 shadow-lg">
                        <h3 class="text-sm text-gray-400 mb-2">已兑换码数</h3>
                        <p id="usedCodes" class="text-3xl font-display font-bold text-white">0</p>
                    </div>
                    <div class="bg-gray-900/50 rounded-xl p-5 border border-gray-700/50 shadow-lg">
                        <h3 class="text-sm text-gray-400 mb-2">今日兑换数</h3>
                        <p id="todayRedeems" class="text-3xl font-display font-bold text-white">0</p>
                    </div>
                    <div class="bg-gray-900/50 rounded-xl p-5 border border-gray-700/50 shadow-lg">
                        <h3 class="text-sm text-gray-400 mb-2">剩余兑换码</h3>
                        <p id="remainingCodes" class="text-3xl font-display font-bold text-white">0</p>
                    </div>
                </div>
                
                <!-- 兑换情况统计 -->
                <div class="bg-gray-900/50 rounded-xl shadow-lg border border-gray-700/50 mb-8 overflow-hidden">
                    <div class="p-5 border-b border-gray-700/50">
                        <h3 class="font-display font-semibold text-white text-lg">兑换情况统计</h3>
                        <p class="text-sm text-gray-400 mt-1">各等级盲盒兑换数据统计</p>
                    </div>
                    <div class="p-5" id="redemptionStatsContainer">
                        <!-- 兑换情况统计将通过JS动态生成 -->
                    </div>
                </div>
                
                <!-- 盲盒设置 -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    <!-- 盲盒概率设置 -->
                    <div class="bg-gray-900/50 rounded-xl shadow-lg border border-gray-700/50 overflow-hidden">
                        <div class="p-5 border-b border-gray-700/50">
                            <h3 class="font-display font-semibold text-white text-lg">盲盒概率设置</h3>
                            <p class="text-sm text-gray-400 mt-1">设置每种盲盒的奖励及对应概率</p>
                        </div>
                        <div class="p-5" id="probabilitySettings">
                            <!-- 概率设置将通过JS动态生成 -->
                        </div>
                        <div class="p-5 border-t border-gray-700/50 flex justify-end">
                            <button id="saveProbabilities" class="px-5 py-2.5 bg-secondary hover:bg-secondary/90 text-white rounded-lg text-sm transition-colors">
                                <i class="fa fa-save mr-1"></i> 保存概率设置
                            </button>
                        </div>
                    </div>
                    
                    <!-- 每日限制设置 -->
                    <div class="bg-gray-900/50 rounded-xl shadow-lg border border-gray-700/50 overflow-hidden">
                        <div class="p-5 border-b border-gray-700/50">
                            <h3 class="font-display font-semibold text-white text-lg">每日兑换数量限制</h3>
                            <p class="text-sm text-gray-400 mt-1">设置每种盲盒每日可兑换的最大数量</p>
                        </div>
                        <div class="p-5 space-y-5" id="dailyLimitSettings">
                            <!-- 每日限制设置将通过JS动态生成 -->
                        </div>
                        <div class="p-5 border-t border-gray-700/50 flex justify-end">
                            <button id="saveDailyLimits" class="px-5 py-2.5 bg-secondary hover:bg-secondary/90 text-white rounded-lg text-sm transition-colors">
                                <i class="fa fa-save mr-1"></i> 保存限制设置
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- 兑换码生成与导入 -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    <!-- 生成兑换码 -->
                    <div class="bg-gray-900/50 rounded-xl shadow-lg border border-gray-700/50 overflow-hidden">
                        <div class="p-5 border-b border-gray-700/50">
                            <h3 class="font-display font-semibold text-white text-lg">生成兑换码</h3>
                            <p class="text-sm text-gray-400 mt-1">批量生成指定类型的兑换码</p>
                        </div>
                        <div class="p-5 space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">盲盒等级</label>
                                <select id="generateBoxType" class="w-full bg-gray-700/50 border border-gray-600 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all">
                                    <!-- 选项将通过JS动态生成 -->
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">奖励内容</label>
                                <input type="text" id="generateReward" placeholder="例如：100积分、论坛VIP" class="w-full bg-gray-700/50 border border-gray-600 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">生成数量</label>
                                <input type="number" id="generateCount" min="1" max="100" value="10" class="w-full bg-gray-700/50 border border-gray-600 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all">
                            </div>
                            <button id="generateCodesBtn" class="w-full py-3 rounded-lg bg-primary hover:bg-primary/90 text-white font-medium transition-all">
                                <i class="fa fa-magic mr-1"></i> 生成兑换码
                            </button>
                        </div>
                    </div>
                    
                    <!-- 导入兑换码 -->
                    <div class="bg-gray-900/50 rounded-xl shadow-lg border border-gray-700/50 overflow-hidden">
                        <div class="p-5 border-b border-gray-700/50">
                            <h3 class="font-display font-semibold text-white text-lg">导入兑换码</h3>
                            <p class="text-sm text-gray-400 mt-1">批量导入已有的兑换码</p>
                        </div>
                        <div class="p-5 space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">兑换码数据</label>
                                <p class="text-xs text-gray-500 mb-2">格式：兑换码,盲盒等级,奖励内容（每行一个）</p>
                                <textarea id="importCodes" class="w-full bg-gray-700/50 border border-gray-600 rounded-lg px-4 py-3 h-36 text-white text-sm focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all" placeholder="例如：
YG84-0001,初级盲盒,10积分
YG84-0002,中级盲盒,20积分
YG84-0003,高级盲盒,50积分"></textarea>
                            </div>
                            <button id="importCodesBtn" class="w-full py-3 rounded-lg bg-primary hover:bg-primary/90 text-white font-medium transition-all">
                                <i class="fa fa-upload mr-1"></i> 导入兑换码
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- 详细兑换记录 -->
                <div class="bg-gray-900/50 rounded-xl shadow-lg border border-gray-700/50 overflow-hidden">
                    <div class="p-5 border-b border-gray-700/50">
                        <h3 class="font-display font-semibold text-white text-lg">详细兑换记录</h3>
                        <p class="text-sm text-gray-400 mt-1">所有盲盒的兑换历史记录</p>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-700/50">
                            <thead class="bg-gray-800/80">
                                <tr>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">兑换码</th>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">盲盒等级</th>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">奖励</th>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">兑换时间</th>
                                </tr>
                            </thead>
                            <tbody id="adminRedeemRecords" class="divide-y divide-gray-700/50">
                                <!-- 兑换记录将通过JS动态生成 -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 通知提示 -->
    <div id="notification" class="fixed bottom-6 right-6 bg-gray-800 border border-gray-700 rounded-xl shadow-xl p-5 transform translate-y-full transition-transform duration-300 z-40 max-w-xs">
        <div class="flex items-start">
            <i id="notificationIcon" class="fa fa-info-circle text-primary mt-0.5 mr-3 text-lg"></i>
            <div>
                <h4 id="notificationTitle" class="font-medium text-white text-base"></h4>
                <p id="notificationMessage" class="text-sm text-gray-400 mt-1"></p>
            </div>
            <button id="closeNotification" class="ml-auto text-gray-500 hover:text-gray-300 transition-colors">
                <i class="fa fa-times"></i>
            </button>
        </div>
    </div>

    <!-- 生成的兑换码模态框 -->
    <div id="generatedCodesModal" class="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center hidden opacity-0 transition-opacity duration-300">
        <div class="bg-gray-800 rounded-2xl w-full max-w-2xl p-6 lg:p-8 shadow-2xl transform transition-all scale-95 opacity-0" id="generatedCodesModalContent">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-display font-bold text-white">生成的兑换码</h3>
                <button id="closeGeneratedCodesBtn" class="text-gray-400 hover:text-white transition-colors">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            <div class="mb-5">
                <p class="text-gray-300 text-sm mb-3">以下是生成的兑换码，您可以复制使用：</p>
                <div class="bg-gray-900/70 rounded-lg p-4 max-h-64 overflow-y-auto font-mono text-sm text-gray-300" id="generatedCodesContainer">
                    <!-- 生成的兑换码将在这里显示 -->
                </div>
            </div>
            <div class="flex justify-end">
                <button id="copyGeneratedCodesBtn" class="px-5 py-2.5 bg-primary hover:bg-primary/90 text-white rounded-lg text-sm transition-colors">
                    <i class="fa fa-copy mr-1"></i> 复制全部
                </button>
            </div>
        </div>
    </div>

    <script>
        // 数据模型
        const AppData = {
            // 初始化数据
            init() {
                // 设置默认管理员密码
                if (!localStorage.getItem('adminPassword')) {
                    localStorage.setItem('adminPassword', 'admin123'); // 默认密码
                }
                
                // 初始化盲盒类型
                if (!localStorage.getItem('boxes')) {
                    const defaultBoxes = [
                        {
                            id: this.generateId(),
                            name: '初级盲盒',
                            icon: 'fa-gift',
                            color: 'primary',
                            dailyLimit: 10,
                            probabilities: [
                                { reward: '10积分', probability: 50 },
                                { reward: '20积分', probability: 30 },
                                { reward: '50积分', probability: 15 },
                                { reward: '100积分', probability: 5 }
                            ]
                        },
                        {
                            id: this.generateId(),
                            name: '中级盲盒',
                            icon: 'fa-cube',
                            color: 'secondary',
                            dailyLimit: 5,
                            probabilities: [
                                { reward: '50积分', probability: 40 },
                                { reward: '100积分', probability: 30 },
                                { reward: '200积分', probability: 20 },
                                { reward: '500积分', probability: 10 }
                            ]
                        },
                        {
                            id: this.generateId(),
                            name: '高级盲盒',
                            icon: 'fa-diamond',
                            color: 'accent',
                            dailyLimit: 3,
                            probabilities: [
                                { reward: '100积分', probability: 30 },
                                { reward: '200积分', probability: 30 },
                                { reward: '500积分', probability: 30 },
                                { reward: '1000积分', probability: 10 }
                            ]
                        }
                    ];
                    localStorage.setItem('boxes', JSON.stringify(defaultBoxes));
                }
                
                // 初始化兑换码
                if (!localStorage.getItem('codes')) {
                    localStorage.setItem('codes', JSON.stringify([]));
                }
                
                // 初始化兑换记录
                if (!localStorage.getItem('redeems')) {
                    localStorage.setItem('redeems', JSON.stringify([]));
                }
                
                // 初始化管理员登录状态
                if (!localStorage.getItem('adminLoggedIn')) {
                    localStorage.setItem('adminLoggedIn', 'false');
                }
            },
            
            // 生成唯一ID
            generateId() {
                return Date.now().toString(36) + Math.random().toString(36).substr(2, 5);
            },
            
            // 生成随机兑换码
            generateRandomCode() {
                const prefix = 'YG84';
                const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
                let segment1 = '';
                let segment2 = '';
                
                for (let i = 0; i < 4; i++) {
                    segment1 += chars.charAt(Math.floor(Math.random() * chars.length));
                }
                
                for (let i = 0; i < 4; i++) {
                    segment2 += chars.charAt(Math.floor(Math.random() * chars.length));
                }
                
                return `${prefix}-${segment1}-${segment2}`;
            },
            
            // 批量生成兑换码
            generateCodes(boxId, reward, count = 10) {
                const codes = [];
                const existingCodes = this.getCodes().map(c => c.code);
                
                for (let i = 0; i < count; i++) {
                    // 确保生成的兑换码不重复
                    let code;
                    do {
                        code = this.generateRandomCode();
                    } while (existingCodes.includes(code) || codes.includes(code));
                    
                    codes.push({
                        code,
                        boxId,
                        reward
                    });
                }
                
                return codes;
            },
            
            // 盲盒相关
            getBoxes() {
                return JSON.parse(localStorage.getItem('boxes') || '[]');
            },
            
            getBoxById(id) {
                const boxes = this.getBoxes();
                return boxes.find(box => box.id === id);
            },
            
            updateBox(updatedBox) {
                const boxes = this.getBoxes();
                const index = boxes.findIndex(box => box.id === updatedBox.id);
                
                if (index === -1) return false;
                
                boxes[index] = updatedBox;
                localStorage.setItem('boxes', JSON.stringify(boxes));
                return true;
            },
            
            updateBoxDailyLimit(boxId, limit) {
                const box = this.getBoxById(boxId);
                if (!box) return false;
                
                box.dailyLimit = parseInt(limit) || 0;
                return this.updateBox(box);
            },
            
            updateBoxProbabilities(boxId, probabilities) {
                const box = this.getBoxById(boxId);
                if (!box) return false;
                
                box.probabilities = probabilities;
                return this.updateBox(box);
            },
            
            // 兑换码相关
            getCodes() {
                return JSON.parse(localStorage.getItem('codes') || '[]');
            },
            
            saveCode(code) {
                const codes = this.getCodes();
                const index = codes.findIndex(c => c.code === code.code);
                
                if (index > -1) {
                    codes[index] = code;
                } else {
                    codes.push(code);
                }
                
                localStorage.setItem('codes', JSON.stringify(codes));
                return code;
            },
            
            importCodes(codesArray) {
                const existingCodes = this.getCodes();
                let newCount = 0;
                
                codesArray.forEach(codeData => {
                    // 检查是否已存在相同兑换码
                    const exists = existingCodes.some(c => c.code === codeData.code);
                    if (!exists) {
                        existingCodes.push({
                            id: this.generateId(),
                            code: codeData.code,
                            boxId: codeData.boxId,
                            reward: codeData.reward,
                            used: false,
                            redeemTime: null
                        });
                        newCount++;
                    }
                });
                
                localStorage.setItem('codes', JSON.stringify(existingCodes));
                return newCount;
            },
            
            getCodeByCodeString(codeString) {
                const codes = this.getCodes();
                return codes.find(c => c.code === codeString);
            },
            
            // 兑换记录相关
            getRedeems() {
                return JSON.parse(localStorage.getItem('redeems') || '[]');
            },
            
            saveRedeem(redeem) {
                const redeems = this.getRedeems();
                redeems.push(redeem);
                localStorage.setItem('redeems', JSON.stringify(redeems));
                return redeem;
            },
            
            // 获取今日兑换数量
            getTodayRedeemsCount() {
                const today = new Date().toISOString().split('T')[0];
                const redeems = this.getRedeems();
                return redeems.filter(r => r.redeemTime.startsWith(today)).length;
            },
            
            // 按盲盒类型获取兑换数量
            getRedeemsCountByBox(boxId) {
                const redeems = this.getRedeems();
                return redeems.filter(r => r.boxId === boxId).length;
            },
            
            // 按盲盒类型获取今日兑换数量
            getTodayRedeemsCountByBox(boxId) {
                const today = new Date().toISOString().split('T')[0];
                const redeems = this.getRedeems();
                return redeems.filter(r => r.boxId === boxId && r.redeemTime.startsWith(today)).length;
            },
            
            // 检查盲盒每日限制
            checkBoxDailyLimit(boxId) {
                const box = this.getBoxById(boxId);
                if (!box || box.dailyLimit <= 0) {
                    return { allowed: true, current: 0, limit: 0 };
                }
                
                const todayCount = this.getTodayRedeemsCountByBox(boxId);
                
                return {
                    allowed: todayCount < box.dailyLimit,
                    current: todayCount,
                    limit: box.dailyLimit
                };
            },
            
            // 管理员相关
            verifyAdminPassword(password) {
                return password === localStorage.getItem('adminPassword');
            },
            
            isAdminLoggedIn() {
                return localStorage.getItem('adminLoggedIn') === 'true';
            },
            
            setAdminLoggedIn(status) {
                localStorage.setItem('adminLoggedIn', status ? 'true' : 'false');
            }
        };

        // 工具函数
        const Utils = {
            // 格式化日期时间
            formatDateTime(dateString) {
                const date = new Date(dateString);
                return date.toLocaleString('zh-CN', {
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            },
            
            // 格式化日期
            formatDate(dateString) {
                const date = dateString ? new Date(dateString) : new Date();
                return date.toLocaleDateString('zh-CN', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    weekday: 'long'
                });
            },
            
            // 显示通知
            showNotification(title, message, type = 'info') {
                const notification = document.getElementById('notification');
                const titleEl = document.getElementById('notificationTitle');
                const messageEl = document.getElementById('notificationMessage');
                const iconEl = document.getElementById('notificationIcon');
                
                titleEl.textContent = title;
                messageEl.textContent = message;
                
                // 设置图标
                iconEl.className = '';
                switch(type) {
                    case 'success':
                        iconEl.className = 'fa fa-check-circle text-secondary mt-0.5 mr-3 text-lg';
                        break;
                    case 'error':
                        iconEl.className = 'fa fa-exclamation-circle text-red-500 mt-0.5 mr-3 text-lg';
                        break;
                    case 'warning':
                        iconEl.className = 'fa fa-exclamation-triangle text-accent mt-0.5 mr-3 text-lg';
                        break;
                    default:
                        iconEl.className = 'fa fa-info-circle text-primary mt-0.5 mr-3 text-lg';
                }
                
                // 显示通知
                notification.classList.remove('translate-y-full');
            },
            
            // 隐藏通知
            hideNotification() {
                document.getElementById('notification').classList.add('translate-y-full');
            },
            
            // 显示模态框并添加动画
            showModal(modalId) {
                const modal = document.getElementById(modalId);
                const modalContent = document.getElementById(`${modalId}Content`) || 
                                    document.querySelector(`#${modalId} > div`);
                
                modal.classList.remove('hidden');
                // 触发重排后添加动画类
                setTimeout(() => {
                    modal.classList.remove('opacity-0');
                    modalContent.classList.remove('scale-95', 'opacity-0');
                }, 10);
            },
            
            // 隐藏模态框并添加动画
            hideModal(modalId) {
                const modal = document.getElementById(modalId);
                const modalContent = document.getElementById(`${modalId}Content`) || 
                                    document.querySelector(`#${modalId} > div`);
                
                modal.classList.add('opacity-0');
                modalContent.classList.add('scale-95', 'opacity-0');
                
                // 动画结束后完全隐藏
                setTimeout(() => {
                    modal.classList.add('hidden');
                }, 300);
            }
        };

        // 视图控制器
        const ViewController = {
            // 初始化视图
            init() {
                // 初始化数据
                AppData.init();
                
                // 设置当前日期和年份
                document.getElementById('currentDate').textContent = Utils.formatDate();
                document.getElementById('currentYear').textContent = new Date().getFullYear();
                
                // 渲染盲盒等级选择
                this.renderBoxSelection();
                
                // 渲染概率说明
                this.renderProbabilityInfo();
                
                // 渲染最近兑换记录
                this.renderRecentRedeems();
                
                // 设置事件监听
                this.setupEventListeners();
            },
            
            // 渲染盲盒等级选择
            renderBoxSelection() {
                const container = document.getElementById('boxSelectionContainer');
                container.innerHTML = '';
                
                const boxes = AppData.getBoxes();
                boxes.forEach(box => {
                    const limitInfo = AppData.checkBoxDailyLimit(box.id);
                    const isLimited = limitInfo.limit > 0;
                    
                    const boxCard = document.createElement('div');
                    boxCard.className = `bg-gray-800 border border-gray-700 rounded-xl p-6 text-center card-hover cursor-pointer transition-all ${isLimited && !limitInfo.allowed ? 'opacity-50 cursor-not-allowed' : ''}`;
                    boxCard.innerHTML = `
                        <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-${box.color}/20 flex items-center justify-center animate-float">
                            <i class="fa ${box.icon} text-${box.color} text-2xl"></i>
                        </div>
                        <h3 class="text-xl font-display font-bold text-white mb-2">${box.name}</h3>
                        ${isLimited ? `
                            <p class="text-sm text-gray-400">今日剩余: ${limitInfo.limit - limitInfo.current}/${limitInfo.limit}</p>
                        ` : ''}
                        ${!limitInfo.allowed ? `
                            <div class="mt-4 py-2 bg-red-900/30 text-red-400 rounded-lg text-sm">
                                <i class="fa fa-exclamation-circle mr-1"></i> 今日已达上限
                            </div>
                        ` : ''}
                    `;
                    
                    // 添加点击事件
                    if (limitInfo.allowed) {
                        boxCard.addEventListener('click', () => {
                            this.selectBox(box.id, box.name, box.color);
                        });
                    }
                    
                    container.appendChild(boxCard);
                });
            },
            
            // 选择盲盒等级
            selectBox(boxId, boxName, boxColor) {
                document.getElementById('selectedBoxId').value = boxId;
                document.getElementById('selectedBoxName').textContent = boxName;
                document.getElementById('selectedBoxName').className = `text-${boxColor}`;
                document.getElementById('redeemCode').value = '';
                
                // 更新限制信息
                const limitInfo = AppData.checkBoxDailyLimit(boxId);
                document.getElementById('boxLimitInfo').textContent = 
                    `今日剩余: ${limitInfo.limit - limitInfo.current}/${limitInfo.limit}`;
                
                // 显示兑换码输入区，隐藏盲盒选择区
                document.getElementById('boxSelectionContainer').closest('div').classList.add('hidden');
                document.getElementById('redeemCodeContainer').classList.remove('hidden');
                
                // 聚焦到输入框
                setTimeout(() => {
                    document.getElementById('redeemCode').focus();
                }, 300);
            },
            
            // 取消选择盲盒
            cancelBoxSelection() {
                // 显示盲盒选择区，隐藏兑换码输入区
                document.getElementById('redeemCodeContainer').classList.add('hidden');
                document.getElementById('boxSelectionContainer').closest('div').classList.remove('hidden');
            },
            
            // 渲染概率说明
            renderProbabilityInfo() {
                const container = document.getElementById('probabilityInfoContainer');
                container.innerHTML = '';
                
                const boxes = AppData.getBoxes();
                boxes.forEach(box => {
                    // 构建概率HTML
                    let probabilitiesHtml = '';
                    box.probabilities.forEach(prob => {
                        probabilitiesHtml += `
                            <div class="mb-2">
                                <div class="flex justify-between text-sm mb-1">
                                    <span class="text-gray-400">${prob.reward}</span>
                                    <span class="font-medium text-white">${prob.probability}%</span>
                                </div>
                                <div class="w-full bg-gray-700/50 rounded-full h-2">
                                    <div class="probability-bar bg-${box.color}" style="width: ${prob.probability}%"></div>
                                </div>
                            </div>
                        `;
                    });
                    
                    const probabilityEl = document.createElement('div');
                    probabilityEl.className = 'bg-gray-900/30 rounded-xl p-5 border border-gray-700/50';
                    probabilityEl.innerHTML = `
                        <h4 class="font-medium text-white mb-4 flex items-center">
                            <i class="fa ${box.icon} text-${box.color} mr-2"></i> ${box.name} 奖励概率
                        </h4>
                        <div>
                            ${probabilitiesHtml}
                        </div>
                    `;
                    container.appendChild(probabilityEl);
                });
            },
            
            // 渲染最近兑换记录
            renderRecentRedeems() {
                const container = document.getElementById('recentRedeems');
                const redeems = AppData.getRedeems();
                
                // 只显示最近10条记录
                const recentRedeems = [...redeems]
                    .sort((a, b) => new Date(b.redeemTime) - new Date(a.redeemTime))
                    .slice(0, 10);
                
                if (recentRedeems.length === 0) {
                    container.innerHTML = `
                        <tr>
                            <td colspan="3" class="px-6 py-10 text-center text-gray-500">
                                <div class="flex flex-col items-center">
                                    <i class="fa fa-inbox text-2xl mb-3"></i>
                                    <span>暂无兑换记录</span>
                                </div>
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                const boxes = AppData.getBoxes();
                container.innerHTML = recentRedeems.map(redeem => {
                    const box = boxes.find(b => b.id === redeem.boxId);
                    return `
                        <tr class="hover:bg-gray-800/50 transition-colors">
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm font-medium text-white">${box ? box.name : '未知'}</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm text-gray-300">${redeem.reward}</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-400">
                                ${Utils.formatDateTime(redeem.redeemTime)}
                            </td>
                        </tr>
                    `;
                }).join('');
            },
            
            // 显示兑换结果
            showRedeemResult(success, message) {
                if (success) {
                    document.getElementById('successResult').classList.remove('hidden');
                    document.getElementById('errorResult').classList.add('hidden');
                    document.getElementById('successMessage').textContent = message;
                } else {
                    document.getElementById('successResult').classList.add('hidden');
                    document.getElementById('errorResult').classList.remove('hidden');
                    document.getElementById('errorMessage').textContent = message;
                }
                
                // 显示结果模态框
                Utils.showModal('resultModal');
            },
            
            // 打开管理员面板
            openAdminPanel() {
                // 检查是否已登录
                if (!AppData.isAdminLoggedIn()) {
                    Utils.showModal('adminLoginModal');
                    return;
                }
                
                // 渲染管理员面板内容
                this.renderAdminPanel();
                
                // 显示管理员面板
                document.getElementById('adminPanel').classList.remove('translate-x-full');
            },
            
            // 关闭管理员面板
            closeAdminPanel() {
                document.getElementById('adminPanel').classList.add('translate-x-full');
            },
            
            // 渲染管理员面板
            renderAdminPanel() {
                // 更新统计数据
                this.updateAdminStats();
                
                // 渲染兑换情况统计
                this.renderRedemptionStats();
                
                // 渲染概率设置
                this.renderProbabilitySettings();
                
                // 渲染每日限制设置
                this.renderDailyLimitSettings();
                
                // 渲染生成兑换码的盲盒类型选择器
                this.renderGenerateBoxTypeSelector();
                
                // 渲染兑换记录
                this.renderAdminRedeemRecords();
            },
            
            // 更新管理员统计数据
            updateAdminStats() {
                const codes = AppData.getCodes();
                const usedCodes = codes.filter(c => c.used);
                const todayRedeems = AppData.getTodayRedeemsCount();
                const remainingCodes = codes.filter(c => !c.used).length;
                
                document.getElementById('totalCodes').textContent = codes.length;
                document.getElementById('usedCodes').textContent = usedCodes.length;
                document.getElementById('todayRedeems').textContent = todayRedeems;
                document.getElementById('remainingCodes').textContent = remainingCodes;
            },
            
            // 渲染兑换情况统计
            renderRedemptionStats() {
                const container = document.getElementById('redemptionStatsContainer');
                container.innerHTML = '';
                
                const boxes = AppData.getBoxes();
                const allRedeems = AppData.getRedeems().length;
                
                boxes.forEach(box => {
                    const boxRedeems = AppData.getRedeemsCountByBox(box.id);
                    const percentage = allRedeems > 0 ? Math.round((boxRedeems / allRedeems) * 100) : 0;
                    const todayRedeems = AppData.getTodayRedeemsCountByBox(box.id);
                    
                    const statsEl = document.createElement('div');
                    statsEl.className = 'mb-6 last:mb-0';
                    statsEl.innerHTML = `
                        <div class="flex justify-between items-center mb-2">
                            <div class="flex items-center">
                                <i class="fa ${box.icon} text-${box.color} mr-2"></i>
                                <span class="text-gray-300 font-medium">${box.name}</span>
                            </div>
                            <div class="text-right">
                                <span class="text-white font-bold">${boxRedeems}</span>
                                <span class="text-gray-500 text-sm ml-1">次兑换</span>
                            </div>
                        </div>
                        <div class="w-full bg-gray-700/50 rounded-full h-2 mb-1">
                            <div class="probability-bar bg-${box.color}" style="width: ${percentage}%"></div>
                        </div>
                        <div class="flex justify-between text-xs text-gray-500">
                            <span>占比: ${percentage}%</span>
                            <span>今日兑换: ${todayRedeems}次</span>
                        </div>
                    `;
                    container.appendChild(statsEl);
                });
            },
            
            // 渲染概率设置
            renderProbabilitySettings() {
                const container = document.getElementById('probabilitySettings');
                container.innerHTML = '';
                
                const boxes = AppData.getBoxes();
                boxes.forEach(box => {
                    let probabilitiesHtml = '';
                    
                    box.probabilities.forEach((prob, index) => {
                        probabilitiesHtml += `
                            <div class="mb-5">
                                <div class="flex flex-wrap items-center gap-4 mb-2">
                                    <div class="w-full sm:w-36">
                                        <label class="block text-sm font-medium text-gray-300 mb-1">奖励 ${index + 1}</label>
                                        <input type="text" value="${prob.reward}" 
                                            class="w-full bg-gray-700/50 border border-gray-600 rounded-lg px-3 py-2 text-white text-sm focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all reward-input"
                                            data-box-id="${box.id}"
                                            data-prob-index="${index}">
                                    </div>
                                    <div class="flex-1">
                                        <label class="block text-sm font-medium text-gray-300 mb-1">概率 ${index + 1}</label>
                                        <div class="flex items-center gap-3">
                                            <input type="range" min="0" max="100" value="${prob.probability}" 
                                                class="flex-1 h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-${box.color} probability-slider"
                                                data-box-id="${box.id}"
                                                data-prob-index="${index}">
                                            <input type="number" min="0" max="100" value="${prob.probability}" 
                                                class="w-16 bg-gray-700/50 border border-gray-600 rounded-lg px-3 py-2 text-white text-sm focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all probability-input"
                                                data-box-id="${box.id}"
                                                data-prob-index="${index}">
                                            <span class="text-gray-400">%</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="w-full bg-gray-700/50 rounded-full h-1.5">
                                    <div class="probability-bar bg-${box.color}" style="width: ${prob.probability}%"></div>
                                </div>
                            </div>
                        `;
                    });
                    
                    const boxProbabilityEl = document.createElement('div');
                    boxProbabilityEl.className = `mb-6 last:mb-0`;
                    boxProbabilityEl.innerHTML = `
                        <h4 class="font-medium text-white mb-4 flex items-center">
                            <i class="fa ${box.icon} text-${box.color} mr-2"></i> ${box.name}
                        </h4>
                        <div class="pl-6 border-l-2 border-${box.color}/30" data-box-id="${box.id}">
                            ${probabilitiesHtml}
                            <div class="flex justify-between items-center pt-2">
                                <span class="text-sm font-medium text-gray-300">总概率</span>
                                <span class="text-sm font-bold text-white total-probability">${box.probabilities.reduce((sum, p) => sum + p.probability, 0)}%</span>
                            </div>
                        </div>
                    `;
                    container.appendChild(boxProbabilityEl);
                });
                
                // 添加概率滑块事件
                document.querySelectorAll('.probability-slider').forEach(slider => {
                    slider.addEventListener('input', (e) => {
                        const value = e.target.value;
                        const boxId = e.target.getAttribute('data-box-id');
                        const index = e.target.getAttribute('data-prob-index');
                        
                        // 更新数值显示
                        const input = e.target.closest('div').querySelector('.probability-input');
                        input.value = value;
                        
                        // 更新进度条
                        const bar = e.target.closest('div').closest('.mb-5').querySelector('.probability-bar');
                        bar.style.width = `${value}%`;
                        
                        // 更新总概率
                        this.updateTotalProbability(boxId);
                    });
                });
                
                // 添加概率输入框事件
                document.querySelectorAll('.probability-input').forEach(input => {
                    input.addEventListener('input', (e) => {
                        let value = parseInt(e.target.value) || 0;
                        // 限制在0-100之间
                        value = Math.max(0, Math.min(100, value));
                        e.target.value = value;
                        
                        const boxId = e.target.getAttribute('data-box-id');
                        const index = e.target.getAttribute('data-prob-index');
                        
                        // 更新滑块和进度条
                        const slider = e.target.closest('div').querySelector('.probability-slider');
                        slider.value = value;
                        
                        const bar = e.target.closest('div').closest('.mb-5').querySelector('.probability-bar');
                        bar.style.width = `${value}%`;
                        
                        // 更新总概率
                        this.updateTotalProbability(boxId);
                    });
                });
            },
            
            // 更新总概率
            updateTotalProbability(boxId) {
                const boxElement = document.querySelector(`[data-box-id="${boxId}"]`);
                const inputs = boxElement.querySelectorAll('.probability-input');
                
                let total = 0;
                inputs.forEach(input => {
                    total += parseInt(input.value) || 0;
                });
                
                const totalEl = boxElement.querySelector('.total-probability');
                totalEl.textContent = `${total}%`;
                
                // 如果总概率不是100%，显示警告
                if (total !== 100) {
                    totalEl.classList.add('text-accent');
                } else {
                    totalEl.classList.remove('text-accent');
                }
            },
            
            // 渲染每日限制设置
            renderDailyLimitSettings() {
                const container = document.getElementById('dailyLimitSettings');
                container.innerHTML = '';
                
                const boxes = AppData.getBoxes();
                boxes.forEach(box => {
                    const limitInfo = AppData.checkBoxDailyLimit(box.id);
                    
                    const settingEl = document.createElement('div');
                    settingEl.className = 'space-y-2';
                    settingEl.innerHTML = `
                        <label class="block text-sm font-medium text-gray-300">
                            <i class="fa ${box.icon} text-${box.color} mr-2"></i>${box.name} 每日兑换上限
                        </label>
                        <div class="flex items-center space-x-3">
                            <input type="number" min="0" value="${box.dailyLimit}" 
                                class="flex-1 bg-gray-700/50 border border-gray-600 rounded-lg px-3 py-2 text-white text-sm focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all daily-limit-input"
                                data-box-id="${box.id}">
                            <span class="text-sm text-gray-400 whitespace-nowrap">今日已用: ${limitInfo.current}</span>
                        </div>
                    `;
                    container.appendChild(settingEl);
                });
            },
            
            // 渲染生成兑换码的盲盒类型选择器
            renderGenerateBoxTypeSelector() {
                const select = document.getElementById('generateBoxType');
                select.innerHTML = '';
                
                const boxes = AppData.getBoxes();
                boxes.forEach(box => {
                    const option = document.createElement('option');
                    option.value = box.id;
                    option.textContent = box.name;
                    select.appendChild(option);
                });
            },
            
            // 渲染管理员兑换记录
            renderAdminRedeemRecords() {
                const container = document.getElementById('adminRedeemRecords');
                const redeems = AppData.getRedeems();
                
                if (redeems.length === 0) {
                    container.innerHTML = `
                        <tr>
                            <td colspan="4" class="px-6 py-10 text-center text-gray-500">
                                <div class="flex flex-col items-center">
                                    <i class="fa fa-history text-2xl mb-3"></i>
                                    <span>暂无兑换记录</span>
                                </div>
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                // 按时间倒序排列
                const sortedRedeems = [...redeems]
                    .sort((a, b) => new Date(b.redeemTime) - new Date(a.redeemTime));
                
                const boxes = AppData.getBoxes();
                container.innerHTML = sortedRedeems.map(redeem => {
                    const box = boxes.find(b => b.id === redeem.boxId);
                    return `
                        <tr class="hover:bg-gray-800/50 transition-colors">
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm font-medium text-white">${redeem.code}</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm text-gray-300">${box ? box.name : '未知'}</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm text-gray-300">${redeem.reward}</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-400">
                                ${Utils.formatDateTime(redeem.redeemTime)}
                            </td>
                        </tr>
                    `;
                }).join('');
            },
            
            // 显示生成的兑换码
            showGeneratedCodes(codes) {
                const container = document.getElementById('generatedCodesContainer');
                container.innerHTML = codes.map(code => code.code).join('\n');
                
                // 显示模态框
                Utils.showModal('generatedCodesModal');
            },
            
            // 设置事件监听
            setupEventListeners() {
                // 关闭通知
                document.getElementById('closeNotification').addEventListener('click', () => {
                    Utils.hideNotification();
                });
                
                // 关闭结果模态框
                document.getElementById('closeResultBtn').addEventListener('click', () => {
                    Utils.hideModal('resultModal');
                    // 刷新数据
                    this.renderBoxSelection();
                    this.renderRecentRedeems();
                    
                    // 如果管理员面板打开，也刷新面板数据
                    if (AppData.isAdminLoggedIn() && !document.getElementById('adminPanel').classList.contains('translate-x-full')) {
                        this.renderAdminPanel();
                    }
                });
                
                // 取消兑换
                document.getElementById('cancelRedeemBtn').addEventListener('click', () => {
                    this.cancelBoxSelection();
                });
                
                // 兑换表单提交
                document.getElementById('redeemForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    const boxId = document.getElementById('selectedBoxId').value;
                    const codeString = document.getElementById('redeemCode').value.trim();
                    
                    if (!codeString) {
                        this.showRedeemResult(false, '请输入兑换码');
                        return;
                    }
                    
                    // 检查每日限制
                    const limitInfo = AppData.checkBoxDailyLimit(boxId);
                    if (!limitInfo.allowed) {
                        const box = AppData.getBoxById(boxId);
                        this.showRedeemResult(false, `今日${box.name}兑换已达上限(${limitInfo.limit}个)`);
                        return;
                    }
                    
                    // 查找兑换码
                    const code = AppData.getCodeByCodeString(codeString);
                    if (!code) {
                        this.showRedeemResult(false, '兑换码不存在');
                        return;
                    }
                    
                    // 检查是否已使用
                    if (code.used) {
                        this.showRedeemResult(false, '该兑换码已被使用');
                        return;
                    }
                    
                    // 检查是否匹配盲盒类型
                    if (code.boxId !== boxId) {
                        const box = AppData.getBoxById(boxId);
                        const codeBox = AppData.getBoxById(code.boxId);
                        this.showRedeemResult(false, `该兑换码适用于${codeBox.name}，不适用于${box.name}`);
                        return;
                    }
                    
                    // 标记为已使用
                    code.used = true;
                    code.redeemTime = new Date().toISOString();
                    AppData.saveCode(code);
                    
                    // 记录兑换
                    const box = AppData.getBoxById(boxId);
                    AppData.saveRedeem({
                        id: AppData.generateId(),
                        boxId,
                        code: codeString,
                        reward: code.reward,
                        redeemTime: new Date().toISOString()
                    });
                    
                    // 重置兑换界面
                    this.cancelBoxSelection();
                    
                    // 显示成功消息
                    this.showRedeemResult(true, `恭喜您成功兑换${box.name}，获得奖励：${code.reward}`);
                });
                
                // 管理员登录按钮
                document.getElementById('adminLoginBtn').addEventListener('click', () => {
                    this.openAdminPanel();
                });
                
                // 管理员登录表单提交
                document.getElementById('adminLoginForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    const password = document.getElementById('adminPassword').value;
                    
                    if (AppData.verifyAdminPassword(password)) {
                        AppData.setAdminLoggedIn(true);
                        document.getElementById('adminLoginModal').classList.add('hidden');
                        this.openAdminPanel();
                        Utils.showNotification('登录成功', '已进入管理员模式', 'success');
                    } else {
                        Utils.showNotification('登录失败', '密码不正确', 'error');
                    }
                });
                
                // 关闭管理员面板
                document.getElementById('closeAdminPanel').addEventListener('click', () => {
                    this.closeAdminPanel();
                });
                
                // 保存概率设置
                document.getElementById('saveProbabilities').addEventListener('click', () => {
                    const boxes = AppData.getBoxes();
                    let allValid = true;
                    
                    boxes.forEach(box => {
                        const boxElement = document.querySelector(`[data-box-id="${box.id}"]`);
                        const rewardInputs = boxElement.querySelectorAll('.reward-input');
                        const probabilityInputs = boxElement.querySelectorAll('.probability-input');
                        
                        // 收集概率数据
                        const probabilities = Array.from(rewardInputs).map((input, index) => ({
                            reward: input.value,
                            probability: parseInt(probabilityInputs[index].value) || 0
                        }));
                        
                        // 检查总概率是否为100%
                        const totalProbability = probabilities.reduce((sum, p) => sum + p.probability, 0);
                        if (totalProbability !== 100) {
                            allValid = false;
                            Utils.showNotification('保存失败', `${box.name}的总概率必须为100%`, 'error');
                            return;
                        }
                        
                        // 保存概率设置
                        AppData.updateBoxProbabilities(box.id, probabilities);
                    });
                    
                    if (allValid) {
                        this.renderProbabilitySettings();
                        this.renderProbabilityInfo(); // 同时更新前端概率说明
                        Utils.showNotification('保存成功', '概率设置已更新', 'success');
                    }
                });
                
                // 保存每日限制设置
                document.getElementById('saveDailyLimits').addEventListener('click', () => {
                    const inputs = document.querySelectorAll('.daily-limit-input');
                    inputs.forEach(input => {
                        const boxId = input.getAttribute('data-box-id');
                        const limit = input.value;
                        AppData.updateBoxDailyLimit(boxId, limit);
                    });
                    
                    this.renderDailyLimitSettings();
                    this.renderBoxSelection(); // 同时更新前端显示
                    Utils.showNotification('保存成功', '每日限制设置已更新', 'success');
                });
                
                // 生成兑换码
                document.getElementById('generateCodesBtn').addEventListener('click', () => {
                    const boxId = document.getElementById('generateBoxType').value;
                    const reward = document.getElementById('generateReward').value.trim();
                    const count = parseInt(document.getElementById('generateCount').value) || 10;
                    
                    if (!reward) {
                        Utils.showNotification('生成失败', '请输入奖励内容', 'error');
                        return;
                    }
                    
                    if (count < 1 || count > 100) {
                        Utils.showNotification('生成失败', '生成数量必须在1-100之间', 'error');
                        return;
                    }
                    
                    // 生成兑换码
                    const generatedCodes = AppData.generateCodes(boxId, reward, count);
                    
                    // 保存兑换码
                    const codesToSave = generatedCodes.map(code => ({
                        id: AppData.generateId(),
                        code: code.code,
                        boxId: code.boxId,
                        reward: code.reward,
                        used: false,
                        redeemTime: null
                    }));
                    
                    codesToSave.forEach(code => AppData.saveCode(code));
                    
                    // 显示生成的兑换码
                    this.showGeneratedCodes(generatedCodes);
                    
                    // 更新统计数据
                    this.updateAdminStats();
                    
                    Utils.showNotification('生成成功', `已生成 ${count} 个兑换码`, 'success');
                });
                
                // 关闭生成的兑换码模态框
                document.getElementById('closeGeneratedCodesBtn').addEventListener('click', () => {
                    Utils.hideModal('generatedCodesModal');
                });
                
                // 复制生成的兑换码
                document.getElementById('copyGeneratedCodesBtn').addEventListener('click', () => {
                    const codesText = document.getElementById('generatedCodesContainer').textContent;
                    navigator.clipboard.writeText(codesText).then(() => {
                        Utils.showNotification('复制成功', '已复制所有兑换码', 'success');
                    }).catch(err => {
                        Utils.showNotification('复制失败', '无法复制内容，请手动复制', 'error');
                        console.error('复制失败:', err);
                    });
                });
                
                // 导入兑换码
                document.getElementById('importCodesBtn').addEventListener('click', () => {
                    const text = document.getElementById('importCodes').value.trim();
                    if (!text) {
                        Utils.showNotification('导入失败', '请输入兑换码数据', 'error');
                        return;
                    }
                    
                    const lines = text.split('\n');
                    const boxes = AppData.getBoxes();
                    const codesToImport = [];
                    
                    lines.forEach((line, index) => {
                        const trimmedLine = line.trim();
                        if (!trimmedLine) return;
                        
                        const parts = trimmedLine.split(',');
                        if (parts.length !== 3) {
                            console.error(`第${index + 1}行格式错误: ${line}`);
                            return;
                        }
                        
                        const [code, boxName, reward] = parts.map(p => p.trim());
                        const box = boxes.find(b => b.name === boxName);
                        
                        if (!box) {
                            console.error(`第${index + 1}行盲盒类型不存在: ${boxName}`);
                            return;
                        }
                        
                        codesToImport.push({
                            code,
                            boxId: box.id,
                            reward
                        });
                    });
                    
                    if (codesToImport.length === 0) {
                        Utils.showNotification('导入失败', '没有可导入的兑换码', 'error');
                        return;
                    }
                    
                    const newCount = AppData.importCodes(codesToImport);
                    this.updateAdminStats();
                    Utils.showNotification('导入成功', `成功导入 ${newCount} 个兑换码`, 'success');
                    
                    // 清空输入框
                    document.getElementById('importCodes').value = '';
                });
                
                // 点击模态框外部关闭
                const modals = ['resultModal', 'adminLoginModal', 'generatedCodesModal'];
                modals.forEach(modalId => {
                    document.getElementById(modalId).addEventListener('click', (e) => {
                        if (e.target === document.getElementById(modalId)) {
                            Utils.hideModal(modalId);
                        }
                    });
                });
            }
        };

        // 初始化应用
        document.addEventListener('DOMContentLoaded', () => {
            ViewController.init();
        });
    </script>
</body>
</html>
    
